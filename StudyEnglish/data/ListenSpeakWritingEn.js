folder_Resource="/data/ListenSpeakWritingEn";var doan_van="",cau_van="",myString="",laplai=2,s_title="",s_content="",dem_doc=0,m_delay=1E3,m_seconds=0,bStop=!1,valueRate=.8,arrayOfLines,indexSpeak=0,diemRecord=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],iTypeWork=0,txt_Translate="",arr_Translate=[],curentDiem=0;
function KhoiTao(){myString=s_content;m_seconds=dem_doc=0;SetShowObject("","ketqua",0);SetMoveView("","ketqua",1);SetMoveView("","btSlide","sliderRect");SetShowObject("","bt_mic",0);SetText("","title",s_title);SetShowObject("","xtimer",0);SetShowObject("","msg",0);SetShowObject("","grRead",0);AllowEditText("","content",0);iTypeWork=1}
function OnEndSpeak(){bStop||(indexSpeak==Length(arrayOfLines)?(SetText("","content",s_content),InvalidateObj("","")):dem_doc>laplai?(SetShowObject("","bt_Check",1),dem_doc=0,PlaySound("ID_SOUND_ALERT"),SetText("","msg",""),SetText("","xtimer",""),KillTimerPage(),InvalidateObj("","")):SetTimerPage(1E3))}var imported=document.createElement("script");imported.src=folder_Resource+"/SpeechToText.js";document.head.appendChild(imported);var txtRead="";
function InitWrite(){arrayOfLines=s_content.match(/[^\r\n|.]+/g);KhoiTao();dem_doc=indexSpeak=0;SetText("","content","");AllowEditText("","content",1);SetShowObject("","bt_Check",0);SetShowObject("","xtimer",1);SetShowObject("","msg",1);SetShowObject("","grRead",0);SetText("","m_diem","Listen and type.");SetText("","wrong_word","");SetShowObject("","bt_NextWrite",1);SetShowObject("","bt_Repeat",0);SetShowObject("","bt_Next",0);SetShowObject("","ketqua",1);StopSound();txtRead="";iTypeWork=2;PlaySound("ID_SOUND_START");
recognizing&&(recognition.stop(),SetRsc("","bt_mic","IMAGE_MIC_OFF"))}
function DocViet(){if(!bStop&&2==iTypeWork){if(0==dem_doc){if(indexSpeak==Length(arrayOfLines)){cau_van=s_title+s_content;KillTimerPage();PlaySound("ID_SOUND_END");SetText("","xtimer","");SetText("","msg","");SetShowObject("","grRead",1);SetText("","title","");InvalidateObj("","");return}var a=indexOf(arrayOfLines[indexSpeak],":");cau_van=arrayOfLines[indexSpeak].substr(a+1);txtRead=txtRead+cau_van+"\r\n";SetText("","title",cau_van);SetShowObject("","ketqua",0);SetText("","content","");SetShowObject("",
"bt_check",0);curentDiem=GetVer()}recognizing&&(recognition.stop(),SetRsc("","bt_mic","IMAGE_MIC_OFF"));dem_doc++;0<wordCountStr(cau_van)&&""!=cau_van?(m_delay=1500*wordCountStr(cau_van),Speak(cau_van,"EN","{pitch:1,rate: "+valueRate+", volume: 1,onstart: OnStartSpeak, onend: OnEndSpeak}"),m_seconds=ceil(m_delay/1E3),SetText("","xtimer",m_seconds),SetText("","msg","Reading... "+dem_doc)):(dem_doc=0,Delay("DocViet()",1));InvalidateObj("","")}}function OnStartSpeak(){KillTimerPage()}
var markWrite=0,markRead=0;
function CheckWrite(){var a=GetText("","content");txtRead=GetText("","title");var b=similarity(a,txtRead);wordCountStr(a);for(var k=txtRead.match(/[^\s|\r\n|.]+/g),d=a.match(/[^\s|\r\n|.]+/g),e=[],c=0;c<d.length;c++)a=k.indexOf(d[c]),-1==a&&e.push(d[c]);SetText("","ww_title","You wrote wrong "+e.length+" error");SetText("","wrong_word",e.toString());SetText("","m_diem",formatNumber(10*b,2)+"%");markWrite=round(10*b);UpdateScore(curentDiem+markWrite+markRead,"Write: "+markWrite+", Read: "+markRead);
SetShowObject("","ketqua",1);SetShowObject("","bt_Repeat",0);SetShowObject("","bt_Next",0);indexSpeak++;dem_doc=0}function InitReading(){bStop=!0;KhoiTao();StopSound();SetText("","xtimer","");SetText("","msg","");SetText("","content","");SetShowObject("","grRead",1);SetShowObject("","ketqua",0);indexSpeak=0;iTypeWork=1;KillTimerPage();PlaySound("ID_SOUND_START");InvalidateObj("","")}
function DocNamNu(){if(bStop){bStop=!1;arrayOfLines=s_content.match(/[^\r\n]+/g);""!=txt_Translate&&(arr_Translate=txt_Translate.match(/[^\r\n]+/g));SetText("","content",arrayOfLines[indexSpeak]);var a=arrayOfLines[indexSpeak].indexOf(":");a=arrayOfLines[indexSpeak].substr(a+1);""!=txt_Translate&&SetText("","content",GetText("","content")+"\r\n__________\r\n"+arr_Translate[indexSpeak]);Speak(a,"EN","{pitch: 1, rate:"+valueRate+",onend: EndCallbackSpeak}");InvalidateObj("","");SetRsc("","l_play","ID_PAUSE")}else Stop("",
"",""),SetRsc("","l_play","ID_PLAY"),bStop=!0}
function EndCallbackSpeak(){if(!bStop)if(indexSpeak++,indexSpeak>=arrayOfLines.length||1!=iTypeWork)PlaySound("ID_SOUND_END"),indexSpeak=0,SetRsc("","l_play","ID_PLAY"),bStop=!0;else{SetText("","content",arrayOfLines[indexSpeak]);""!=txt_Translate&&SetText("","content",GetText("","content")+"\r\n__________\r\n"+arr_Translate[indexSpeak]);var a=arrayOfLines[indexSpeak].indexOf(":");a=arrayOfLines[indexSpeak].substr(a+1);0==indexSpeak%2?Speak(a,"EN","{pitch: 1, rate:"+valueRate+",onend: EndCallbackSpeak}"):
Speak(a,"UK English Male","{pitch: 1, rate: "+valueRate+",onend: EndCallbackSpeak}");InvalidateObj("","")}}
function SpeakAgain(){0>=indexSpeak&&(indexSpeak=0);if(indexSpeak>=arrayOfLines.length||1!=iTypeWork)indexSpeak=arrayOfLines.length-1;bStop=!0;Stop("","","");SetText("","content",arrayOfLines[indexSpeak]);""!=txt_Translate&&SetText("","content",GetText("","content")+"\r\n__________\r\n"+arr_Translate[indexSpeak]);var a=arrayOfLines[indexSpeak].indexOf(":");a=arrayOfLines[indexSpeak].substr(a+1);0==indexSpeak%2?Speak(a,"EN","{pitch: 1, rate:"+valueRate+"}"):Speak(a,"UK English Male","{pitch: 1, rate: "+
valueRate+"}");InvalidateObj("","")}var bShowHideText=!1;function HideShowText(){bShowHideText?(SetFontColor("","title","#000000"),SetFontColor("","content","#000000"),SetText("","bt_shText","Hide text")):(SetFontColor("","title","#ebebeb"),SetFontColor("","content","#FFFFFF"),SetText("","bt_shText","Show text"));1!=iTypeWork&&SetFontColor("","content","#000000");bShowHideText=!bShowHideText;InvalidateObj("","")}
function RecordIndex(){if(recognizing)recognition.stop(),SetRsc("","bt_mic","IMAGE_MIC_OFF"),recognizing=!recognizing,InvalidateObj("","");else if(indexSpeak>=Length(arrayOfLines)){SetText("","ww_title","You have finished the reading.");SetText("","wrong_word","You have finished the reading.");SetFontColor("","content","#000000");for(var a=0,b=0;b<arrayOfLines.length;b++)a+=parseInt(diemRecord[b],10);a/=arrayOfLines.length;SetText("","m_diem",ceil(a)+"%");50<a?SetFontColor("","m_diem","#2ECC71"):
SetFontColor("","m_diem","#EB1B07");markRead=ceil(a);UpdateScore(curentDiem+markWrite+markRead,"Write: "+markWrite+", Read: "+markRead);SetShowObject("","bt_Repeat",0);SetShowObject("","bt_Next",0);SetShowObject("","ketqua",1)}else a=arrayOfLines[indexSpeak].indexOf(":"),a=arrayOfLines[indexSpeak].substr(a+1),SetText("","title",a),SetText("","content",""),Speak(a,"EN","{pitch: 1, rate:"+valueRate+",onend: StartStopRecord}"),SetShowObject("","ketqua",0)}
function InitRecord(){KillTimerPage();StopSound();SetShowObject("","bt_mic",1);SetShowObject("","xtimer",0);SetShowObject("","msg",0);SetRsc("","bt_mic","IMAGE_MIC_OFF");SetText("","content","");SetFontColor("","title","#000000");SetText("","title",s_title);SetFontColor("","content","#000000");PlaySound("ID_SOUND_START");AllowEditText("","content",0);bShowHideText=!1;iTypeWork=3;arrayOfLines=myString.match(/[^\r\n]+/g);indexSpeak=0;curentDiem=GetVer();SetShowObject("","bt_check",0);SetShowObject("",
"grRead",0);SetShowObject("","ketqua",0)}var final_transcript="",recognizing=!1;function StartStopRecord(){recognizing?(recognition.stop(),SetRsc("","bt_mic","IMAGE_MIC_OFF")):(recognition.start(),SetRsc("","bt_mic","IMAGE_MIC_REC"),final_transcript="",SetText("","content",final_transcript),SetFontColor("","content","#000000"));recognizing=!recognizing;InvalidateObj("","")}
function Page_1(){s_title=$("#idTitle").clone().children().remove().end().text();s_content=$("#idContent").text().trim();var a=lastIndexOf(s_content,"_____",0);0<a&&(txt_Translate=trimStr(subString(s_content,a+6)),a=indexOf(s_content,"_____",0),s_content=trimStr(subString(s_content,0,a-1)));SetText("","content",s_content);SetText("","title",s_title);SetShowObject("","bt_check",0);InvalidateObj("","");KhoiTao()}
function Page_1_OnTimer(){bStop||(m_seconds--,SetText("","xtimer",m_seconds),0>m_seconds&&(KillTimerPage(),DocViet()),InvalidateObj("",""))}
window.onload=function(){if(document.createElement("canvas").getContext){document.getElementById("Doc").textContent="";stage=new Kinetic.Stage({container:"Doc",width:500,height:350});var a=new Kinetic.Layer({name:"Page_1",callback:"Page_1()"}),b=CreText("Page_1_Backrounnd",0,0,500,350,"","#004080","","","","",12,"Times New Roman","","left","center",0,"0.00","0",0,"0",0,"#004080","0","0","0","","0","0","0","0",0,0,""),k=CreText("title",14,46,479,62,"What\u2019s your favorite sport?","#ebebeb","#ffffff",
"#000000","#ffffff","",16,"Arial","Bold","center","middle",0,"0.00","0","0",2,"#c0c0c0","#ebebeb","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);k.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;2<=iTypeWork&&SpeakEN("","")});var d=CreText("content",14,110,480,214,"A: Please let me introduce myself? I\u2019m Quang.\r\nB: I\u2019m John Smith. Please to meet you.\r\nA: Are you Australian?\r\nB: No, I am American.\r\nA: Do you like Ha Noi?\r\nB: Yes, I like it very much.\r\nA: Are you here on vacation?\r\nB: No, I\u2019m not. I\u2019m here working.",
"#ffffff","#ffffff","#000000","#ffffff","",16,"Arial","Normal","left","top",0,"0.00","0","0",2,"#7f7f7f","#ffffff","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",5,1.7),e=CreText("sliderRect",359,329,136,17,"Slow                           Fast","#ff0000","#ffffff","#ffffff","#ffffff","",10,"Arial","Normal","center","middle",0,"0.00","0","0",1,"#ffffff","#00008b","4","1","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5),c=CreText("Text_4",221,10,101,36,"Speak  ","#ffffff","#ffffff",
"#000000","#ffffff","",16,"Arial","Normal","right","middle",0,"0.00","0","0",1,"#c0c0c0","#c0c0c0","4","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);c.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;InitRecord()});var l=CreText("Text_2",119,10,93,36,"Write  ","#ffffff","#ffffff","#000000","#ffffff","",16,"Arial","Normal","right","middle",0,"0.00","0","0",1,"#c0c0c0","#c0c0c0","4","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);l.on("mouseup touchend dragend",
function(a){m_pgObjCaller=this;bStop=!1;InitWrite()});var m=CreText("Text_3",121,12,31,31,"2. Writing","#ffffff","#ffffff","rgba(0,0,0,0)","#ffffff","ID_IMAGE_WRITE.PNG",16,"Arial","Normal","left","middle",0,"0.00","0","0",2,"rgba(0,0,0,0)","#e6e6fa","2","2","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);m.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;bStop=!1;InitWrite();DocViet()});var B=CreText("msg",408,85,82,20,"","rgba(0,0,0,0)","#ffffff","#000000","#ffffff","",14,
"Arial","Normal","left","middle",0,"0.00","0","0",0,"rgba(0,0,0,0)","#ffffff","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5),C=CreText("xtimer",371,85,31,20,"","rgba(0,0,0,0)","#ffffff","#000000","#ffffff","",14,"Arial","Normal","right","middle",0,"0.00","0","0",0,"rgba(0,0,0,0)","#ffffff","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5),n=CreText("txtDiem",226,13,31,31,"3. Speaking","#ffffff","#ffffff","rgba(0,0,0,0)","#ffffff","ID_IMAGE_SPEAK.PNG",16,"Arial",
"Normal","left","middle",0,"0.00","0","0",2,"rgba(0,0,0,0)","#e6e6fa","2","2","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);n.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;InitRecord()});var D=CreText("wrong_word",135,163,257,106,"","#e6e6fa","#ffffff","#000000","#ffffff","",14,"Arial","Normal","center","top",3,"0.00","5","0",1,"#0000ff","#e6e6fa","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",5,1.5),E=CreText("ww_title",135,145,257,19,":: http://gamechocon.com",
"rgba(0,128,192,1.04)","#ffffff","#ffffff","#ffffff","",14,"Arial","Normal","left","middle",0,"0.00","0","0",1,"#666666","rgba(0,128,192,1.04)","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5),p=CreText("btClose",375,147,15,15,"X","#ff0000","#ffffff","#ffffff","#ffffff","",10,"Arial","Normal","center","middle",0,"0.00","0","0",1,"#ffffff","#ff0000","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);p.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;SetShowObject("",
"ketqua",0)});var F=CreText("m_diem",135,178,256,63,"","rgba(0,0,0,0)","#ffffff","#0080c0","#ffffff","",28,"Arial","Normal","center","middle",0,"0.00","0","0",0,"rgba(0,0,0,0)","#ffffff","0","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5),q=CreText("Text_1",14,10,96,36,"Listen  ","#ffffff","#ffffff","#000000","#ffffff","",16,"Arial","Normal","right","middle",0,"0.00","0","0",1,"#c0c0c0","#c0c0c0","4","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);q.on("mouseup touchend dragend",
function(a){m_pgObjCaller=this;InitReading()});var r=CreText("bt_Listen",16,12,35,31,"Listen","#ffffff","#ffffff","rgba(0,0,0,0)","#ffffff","ID_IMAGE_LISTEN.PNG",16,"Arial","Normal","left","middle",3,"0.00","5","0",0,"rgba(0,0,0,0)","#e6e6fa","2","2","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);r.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;InitReading()});var t=CreText("btSlide",418,329,18,17,"|","#c0c0c0","#ffffff","#ff0000","#ffffff","",14,"Arial","Normal","center",
"bottom",0,"0.00","1","1",1,"#c0c0c0","#f4f4f4","4","1","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);t.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;a=GetWidth("","")/2;var A=GetLeft("","sliderRect")+a;valueRate=1.5*(GetLeft("","")+a-A)/(GetWidth("","sliderRect")-2*a)});var u=CreText("bt_mic",441,54,48,48,"","#ffffff","#ffffff","#000000","#ffffff","",16,"Arial","Normal","center","middle",0,"0.00","0","0",0,"rgba(0,0,0,0)","#000000","2","2","rgba(0,0,0,0)","0","0","4",
"0",0,0,"rgba(0,0,0,0)",0,1.5);u.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;RecordIndex()});var v=CreText("bt_Next",279,239,78,23,"Next","rgba(255,255,255,0.89)","#ffffff","#000000","#ffffff","",14,"Arial","Bold","center","middle",3,"0.00","5","0",1,"#0000ff","rgba(155,205,255,0.89)","4","1","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);v.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;indexSpeak++;RecordIndex()});var w=CreText("bt_Repeat",162,239,78,23,
"Repeat","rgba(255,255,255,0.89)","#ffffff","#000000","#ffffff","",14,"Arial","Bold","center","middle",3,"0.00","5","0",1,"#0000ff","rgba(155,205,255,0.89)","4","1","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);w.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;RecordIndex()});var x=CreText("bt_check",442,53,48,48,"","rgba(0,0,0,0)","","","","ID_IMAGE_CHECK.PNG",0,"","","","",0,"0.00","0","0",1,"rgba(0,0,0,0)","","2","2","","0","0","4","0",0,0,"#808080");x.on("mouseup touchend dragend",
function(a){m_pgObjCaller=this;CheckWrite()});var f=CreText("l_play",152,280,42,43,"","rgba(0,0,0,0)","","","","ID_PLAY.PNG",0,"","","","",0,"0.00","0","0",1,"rgba(0,0,0,0)","","2","2","","0","0","4","0",0,0,"#808080");f.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;DocNamNu()});var g=CreText("l_repeat",202,280,42,43,"","rgba(0,0,0,0)","","","","ID_CUR.PNG",0,"","","","",0,"0.00","0","0",1,"rgba(0,0,0,0)","","2","2","","0","0","4","0",0,0,"#808080");g.on("mouseup touchend dragend",
function(a){m_pgObjCaller=this;SpeakAgain()});var h=CreText("l_next",252,280,42,43,"","rgba(0,0,0,0)","","","","ID_NEXT.PNG",0,"","","","",0,"0.00","0","0",1,"rgba(0,0,0,0)","","2","2","","0","0","4","0",0,0,"#808080");h.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;indexSpeak++;SpeakAgain()});var y=CreText("l_pre",302,280,42,43,"","rgba(0,0,0,0)","","","","ID_PRE.PNG",0,"","","","",0,"0.00","0","0",1,"rgba(0,0,0,0)","","2","2","","0","0","4","0",0,0,"#808080");y.on("mouseup touchend dragend",
function(a){m_pgObjCaller=this;indexSpeak--;SpeakAgain()});var z=new Kinetic.Group({name:"grRead",x:0,y:0,width:196,height:47});z.add(f,g,h,y);f=CreText("bt_shText",410,26,83,19,"Hide text","#e6e6fa","#ffffff","#000000","#ffffff","",12,"Arial","Normal","center","middle",0,"0.00","0","0",1,"#ffffff","#ffffff","4","0","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);f.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;HideShowText()});g=CreText("bt_NextWrite",228,239,78,23,"OK",
"rgba(255,255,255,0.89)","#ffffff","#000000","#ffffff","",14,"Arial","Bold","center","middle",3,"0.00","5","0",1,"#0000ff","rgba(155,205,255,0.89)","4","1","rgba(0,0,0,0)","0","0","4","0",0,0,"rgba(0,0,0,0)",0,1.5);g.on("mouseup touchend dragend",function(a){m_pgObjCaller=this;DocViet()});h=new Kinetic.Group({name:"ketqua",x:0,y:0,width:261,height:128});h.add(D,F,E,p,w,g,v);a.add(b,k,d,e,c,l,m,B,C,n,q,r,t,u,x,z,f,h);stage.add(a);InitLacVietScript()}else alert("Trinh duyet khong ho tro")};